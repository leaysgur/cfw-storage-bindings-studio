var tt=Object.defineProperty;var Fe=a=>{throw TypeError(a)};var n=(a,e)=>tt(a,"name",{value:e,configurable:!0});var ke=(a,e,t)=>e.has(a)||Fe("Cannot "+t);var _=(a,e,t)=>(ke(a,e,"read from private field"),t?t.call(a):e.get(a)),Z=(a,e,t)=>e.has(a)?Fe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),ee=(a,e,t,r)=>(ke(a,e,"write to private field"),r?r.call(a,t):e.set(a,t),t),te=(a,e,t)=>(ke(a,e,"access private method"),t);import{a as u,t as P,c as E,b as Ke}from"../chunks/disclose-version.BbL9ofby.js";import{aG as at,C as rt,h as st,p as ve,t as Q,a as de,s as p,c as m,r as d,m as i,v as W,i as ze,f as q,J as z,au as ce,av as nt,Y as it}from"../chunks/runtime.DGYXNv_o.js";import{e as be,d as _e,s as H}from"../chunks/render.BQbOHs_-.js";import{i as K}from"../chunks/if.6eDf-x_W.js";import{S as ot,s as ut,u as Re,n as Ae,e as Pe,i as Be}from"../chunks/context.CNAOubcP.js";import{a as Te,r as lt,s as ct}from"../chunks/attributes.BkVHChdm.js";import{l as vt}from"../chunks/shared.St246CvB.js";import{s as he,a as X,p as dt}from"../chunks/stores.BDonSuMi.js";import{Q as ht,a as gt,u as ge,i as mt,n as ft,c as Je}from"../chunks/createQuery.RWPW4Ur5.js";import{r as Ce,g as bt,d as _t}from"../chunks/parse.RgkxDUh4.js";import{i as Ee,h as yt,a as pt,g as xt}from"../chunks/infiniteQueryBehavior.CJo7wkMf.js";import{r as Ue}from"../chunks/misc.DaK-wyZN.js";import{p as kt}from"../chunks/proxy.CNLJWbkU.js";import{b as Ie}from"../chunks/this.rGVX0ZeN.js";function Pt(a,e,t=e){var r=at();vt(a,"input",()=>{var s=$e(a)?De(a.value):a.value;t(s),r&&s!==(s=e())&&(a.value=s??"")}),rt(()=>{var s=e();if(st&&a.defaultValue!==a.value){t(a.value);return}$e(a)&&s===De(a.value)||a.type==="date"&&!s&&!a.value||s!==a.value&&(a.value=s??"")})}n(Pt,"bind_value");function $e(a){var e=a.type;return e==="number"||e==="range"}n($e,"is_numberlike_input");function De(a){return a===""?null:+a}n(De,"to_number");var ae,qt=(ae=class extends ht{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e,t){super.setOptions({...e,behavior:Ee()},t)}getOptimisticResult(e){return e.behavior=Ee(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var b,D;const{state:r}=e,s=super.createResult(e,t),{isFetching:h,isRefetching:c,isError:f,isRefetchError:l}=s,v=(D=(b=r.fetchMeta)==null?void 0:b.fetchMore)==null?void 0:D.direction,x=f&&v==="forward",o=h&&v==="forward",g=f&&v==="backward",$=h&&v==="backward";return{...s,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:yt(t,r.data),hasPreviousPage:pt(t,r.data),isFetchNextPageError:x,isFetchingNextPage:o,isFetchPreviousPageError:g,isFetchingPreviousPage:$,isRefetchError:l&&!x&&!g,isRefetching:c&&!o&&!$}}},n(ae,"InfiniteQueryObserver"),ae),J,U,N,A,B,fe,qe,re,Nt=(re=class extends ot{constructor(t,r){super();Z(this,B);Z(this,J);Z(this,U);Z(this,N);Z(this,A);ee(this,J,t),this.setOptions(r),this.bindMethods(),te(this,B,fe).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const r=this.options;this.options=_(this,J).defaultMutationOptions(t),ut(this.options,r)||_(this,J).getMutationCache().notify({type:"observerOptionsUpdated",mutation:_(this,N),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&Re(r.mutationKey)!==Re(this.options.mutationKey)?this.reset():((s=_(this,N))==null?void 0:s.state.status)==="pending"&&_(this,N).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=_(this,N))==null||t.removeObserver(this)}onMutationUpdate(t){te(this,B,fe).call(this),te(this,B,qe).call(this,t)}getCurrentResult(){return _(this,U)}reset(){var t;(t=_(this,N))==null||t.removeObserver(this),ee(this,N,void 0),te(this,B,fe).call(this),te(this,B,qe).call(this)}mutate(t,r){var s;return ee(this,A,r),(s=_(this,N))==null||s.removeObserver(this),ee(this,N,_(this,J).getMutationCache().build(_(this,J),this.options)),_(this,N).addObserver(this),_(this,N).execute(t)}},J=new WeakMap,U=new WeakMap,N=new WeakMap,A=new WeakMap,B=new WeakSet,fe=n(function(){var r;const t=((r=_(this,N))==null?void 0:r.state)??xt();ee(this,U,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},"#updateResult"),qe=n(function(t){Ae.batch(()=>{var r,s,h,c,f,l,v,x;if(_(this,A)&&this.hasListeners()){const o=_(this,U).variables,g=_(this,U).context;(t==null?void 0:t.type)==="success"?((s=(r=_(this,A)).onSuccess)==null||s.call(r,t.data,o,g),(c=(h=_(this,A)).onSettled)==null||c.call(h,t.data,null,o,g)):(t==null?void 0:t.type)==="error"&&((l=(f=_(this,A)).onError)==null||l.call(f,t.error,o,g),(x=(v=_(this,A)).onSettled)==null||x.call(v,void 0,t.error,o,g))}this.listeners.forEach(o=>{o(_(this,U))})})},"#notify"),n(re,"MutationObserver"),re);function Kt(a,e){return gt(a,qt)}n(Kt,"createInfiniteQuery");function Me(a,e){const t=ge(),r=mt(a)?a:Ce(a),s=new Nt(t,bt(r));let h;r.subscribe(l=>{h=n((v,x)=>{s.mutate(v,x).catch(ft)},"mutate"),s.setOptions(l)});const c=Ce(s.getCurrentResult(),l=>s.subscribe(Ae.batchCalls(v=>l(v)))),{subscribe:f}=_t(c,l=>({...l,mutate:h,mutateAsync:l.mutate}));return{subscribe:f}}n(Me,"createMutation");const Le=new TextDecoder,je=new TextEncoder,Ne=Le.decode.bind(Le),Ye=je.encode.bind(je);var Mt=P('<form class="svelte-1qzs0fj"><label class="svelte-1qzs0fj">Key: <input type="text" name="key" required></label> <label class="svelte-1qzs0fj">Value: <div class="svelte-1qzs0fj"><textarea name="text-value"></textarea> <span>OR</span> <input type="file" name="binary-value"></div></label> <button type="submit">Put</button></form>');function Qt(a,e){ve(e,!0);const t=he(),r=n(()=>X(i(h),"$putMutation",t),"$putMutation"),s=ge();let h=W(()=>Me({mutationFn:n(([l,v])=>Promise.resolve(v instanceof File?v.arrayBuffer():Ye(v)).then(x=>e.KV.put(l,x).then(()=>l)),"mutationFn"),onSuccess:n(l=>{s.invalidateQueries({queryKey:["kv",e.bindingName,"list"]}),s.invalidateQueries({queryKey:["kv",e.bindingName,l]})},"onSuccess")}));var c=Mt(),f=p(m(c),4);d(c),Q(()=>f.disabled=r().isPending),be("submit",c,l=>{l.preventDefault();const v=new FormData(l.currentTarget),[x,o,g]=[v.get("key"),v.get("text-value"),v.get("binary-value")];if(g instanceof File&&g.size!==0)return r().mutate([String(x),g]);r().mutate([String(x),String(o)])}),u(a,c),de()}n(Qt,"Add_key");var St=P("<pre> </pre>"),Vt=P("<pre>ðŸ™ˆ Value was `null`...</pre>"),Ot=n((a,e,t)=>z(e,kt(i(t))),"on_click$3"),wt=P("<button> </button>"),Ft=P("<pre> </pre>"),Rt=P('<textarea readonly="" disabled class="svelte-1v8em61"></textarea> <div class="view-as svelte-1v8em61">View as: <!></div> <dialog><!></dialog>',1);function Ct(a,e){ve(e,!0);const t=he(),r=n(()=>X(i(l),"$getQuery",t),"$getQuery"),s=n(o=>{try{return JSON.stringify(JSON.parse(Ne(o)),null,2)}catch{return"ðŸ¤¯ Not valid JSON!"}},"prettifyJSON"),h=["json"];let c=ce(null),f=ce(null);ze(()=>{var o,g;return i(c)!==null?(o=i(f))==null?void 0:o.showModal():(g=i(f))==null?void 0:g.close()});let l=W(()=>Je({queryKey:["kv",e.bindingName,e.key.name],queryFn:n(()=>e.KV.get(e.key.name,"arrayBuffer"),"queryFn")}));var v=E(),x=q(v);K(x,()=>r().isLoading,o=>{var g=Ke("ðŸŒ€ Loading value...");u(o,g)},o=>{var g=E(),$=q(g);K($,()=>r().isError,y=>{var b=St(),D=m(b);d(b),Q(()=>H(D,`ðŸ’¥ ${r().error.message??""}`)),u(y,b)},y=>{var b=E(),D=q(b);K(D,()=>r().isSuccess,I=>{var k=E(),L=q(k);K(L,()=>r().data===null,Y=>{var F=Vt();u(Y,F)},Y=>{var F=Rt(),S=q(F);Ue(S),Q(()=>Te(S,Ne(r().data)));var R=p(S,2),C=p(m(R));Pe(C,17,()=>h,Be,(V,O)=>{var w=wt();w.__click=[Ot,c,O];var G=m(w);d(w),Q(()=>H(G,i(O))),u(V,w)}),d(R);var M=p(R,2);Ie(M,V=>z(f,V),()=>i(f));var T=m(M);K(T,()=>i(c)==="json",V=>{var O=Ft(),w=m(O);Q(()=>H(w,s(r().data))),d(O),u(V,O)}),d(M),be("close",M,()=>z(c,null)),u(Y,F)}),u(I,k)},null,!0),u(y,b)},!0),u(o,g)}),u(a,v),de()}n(Ct,"Show_value");_e(["click"]);var Et=P("<pre> </pre>"),$t=n((a,e)=>z(e,!1),"on_click$2"),Dt=P("<pre>ðŸ™ˆ Value was `null`</pre> <button>Cancel</button>",1),Lt=n((a,e)=>z(e,!1),"on_click_1$1"),jt=P('<form class="svelte-1rcndpl"><label class="svelte-1rcndpl">Value: <div class="svelte-1rcndpl"><textarea name="text-value" class="svelte-1rcndpl"></textarea> OR <input type="file" name="binary-value"></div></label> <div><button>Cancel</button> <button type="submit">Put</button></div></form>'),zt=n((a,e)=>z(e,!0),"on_click_2$1"),At=P("<dialog><!></dialog> <button>Update</button>",1);function Bt(a,e){ve(e,!0);const t=he(),r=n(()=>X(i(f),"$getQuery",t),"$getQuery"),s=n(()=>X(v,"$putMutation",t),"$putMutation");let h=ce(!1),c=ce(null);ze(()=>{var y,b;return i(h)?(y=i(c))==null?void 0:y.showModal():(b=i(c))==null?void 0:b.close()});let f=W(()=>Je({queryKey:["kv",e.bindingName,e.key.name],queryFn:n(()=>e.KV.get(e.key.name,"arrayBuffer"),"queryFn"),enabled:i(h),select:n(y=>y===null?null:Ne(y),"select")}));const l=ge(),v=Me({mutationFn:n(y=>Promise.resolve(y instanceof File?y.arrayBuffer():Ye(y)).then(b=>e.KV.put(e.key.name,b)),"mutationFn"),onSuccess:n(()=>{l.invalidateQueries({queryKey:["kv",e.bindingName,e.key.name]}),z(h,!1)},"onSuccess")});var x=At(),o=q(x);Ie(o,y=>z(c,y),()=>i(c));var g=m(o);K(g,()=>r().isLoading,y=>{var b=Ke("ðŸŒ€ Loading value...");u(y,b)},y=>{var b=E(),D=q(b);K(D,()=>r().isError,I=>{var k=Et(),L=m(k);d(k),Q(()=>H(L,`ðŸ’¥ ${r().error.message??""}`)),u(I,k)},I=>{var k=E(),L=q(k);K(L,()=>r().isSuccess,Y=>{var F=E(),S=q(F);K(S,()=>r().data===null,R=>{var C=Dt(),M=p(q(C),2);M.__click=[$t,h],u(R,C)},R=>{var C=jt(),M=m(C),T=p(m(M)),V=m(T);Ue(V),nt(2),d(T),d(M);var O=p(M,2),w=m(O);w.__click=[Lt,h];var G=p(w,2);d(O),d(C),Q(()=>{Te(V,r().data),G.disabled=s().isPending}),be("submit",C,se=>{se.preventDefault();const ne=new FormData(se.currentTarget),[Qe,ie]=[ne.get("text-value"),ne.get("binary-value")];if(ie instanceof File&&ie.size!==0)return s().mutate(ie);s().mutate(String(Qe))}),u(R,C)}),u(Y,F)},null,!0),u(I,k)},!0),u(y,b)}),d(o);var $=p(o,2);$.__click=[zt,h],be("close",o,()=>z(h,!1)),u(a,x),de()}n(Bt,"Update_key");_e(["click"]);var Tt=n((a,e,t)=>confirm("Are you sure?")&&e().mutate(),"on_click$1"),Jt=P("<button>Delete</button>");function Ut(a,e){ve(e,!0);const t=he(),r=n(()=>X(h,"$deleteMutation",t),"$deleteMutation"),s=ge(),h=Me({mutationFn:n(()=>e.KV.delete(e.key.name),"mutationFn"),onSuccess:n(()=>{s.invalidateQueries({queryKey:["kv",e.bindingName]})},"onSuccess")});var c=Jt();c.__click=[Tt,r,h],Q(()=>c.disabled=r().isPending),u(a,c),de()}n(Ut,"Delete_key");_e(["click"]);var It=P("<pre> </pre>"),Yt=n((a,e,t)=>e.invalidateQueries({queryKey:i(t)}),"on_click"),Gt=n((a,e,t,r)=>e.invalidateQueries({queryKey:["kv",i(t),i(r).name]}),"on_click_1"),Wt=P('<tr><td align="left" class="svelte-14gq3lk"> </td><td align="left" class="svelte-14gq3lk"><!></td><td class="svelte-14gq3lk"><button>Refresh</button> <!> <!></td></tr>'),Ht=P('<tr><td class="svelte-14gq3lk">No entries...</td></tr>'),Xt=n((a,e,t)=>e().fetchNextPage(),"on_click_2"),Zt=P("<button>Load more</button>"),ea=P('<div class="action svelte-14gq3lk"><label>Filter key: <input type="search"></label> <button>Refresh all</button></div> <div class="scroller svelte-14gq3lk"><table class="svelte-14gq3lk"><thead><tr><th>Key</th><th>Value</th><th>Actions</th></tr></thead><tbody></tbody></table></div> <!>',1),ta=P('<section class="svelte-14gq3lk"><h2> </h2> <details><summary>Add new key:value</summary> <!></details> <!></section>');function ba(a,e){ve(e,!0);const t=he(),r=n(()=>X(dt,"$page",t),"$page"),s=n(()=>X(i(x),"$listQuery",t),"$listQuery"),{bindings:h}=it("appContext"),c=ge();let f=W(()=>r().params.bindingName),l=W(()=>h[i(f)]),v=W(()=>["kv",i(f),"list"]),x=W(()=>Kt({queryKey:i(v),queryFn:n(({pageParam:k})=>i(l).list({cursor:k.cursor,limit:25}),"queryFn"),initialPageParam:{cursor:null},getNextPageParam:n(k=>k.list_complete?void 0:k,"getNextPageParam")})),o=ce("");var g=ta(),$=m(g),y=m($);d($);var b=p($,2),D=p(m(b),2);Qt(D,{get KV(){return i(l)},get bindingName(){return i(f)}}),d(b);var I=p(b,2);K(I,()=>s().isLoading,k=>{var L=Ke("ðŸŒ€ Loading keys...");u(k,L)},k=>{var L=E(),Y=q(L);K(Y,()=>s().isError,F=>{var S=It(),R=m(S);d(S),Q(()=>H(R,`ðŸ’¥ ${s().error.message??""}`)),u(F,S)},F=>{var S=E(),R=q(S);K(R,()=>s().isSuccess,C=>{var M=ea(),T=q(M),V=m(T),O=p(m(V));lt(O),d(V);var w=p(V,2);w.__click=[Yt,c,v],d(T);var G=p(T,2),se=m(G),ne=p(m(se));Pe(ne,5,n(()=>s().data.pages,"$$array"),Be,(oe,ue)=>{var Se=E(),Ge=q(Se);Pe(Ge,17,()=>i(ue).keys,le=>le.name,(le,j)=>{var me=E(),We=q(me);K(We,()=>i(o)===""||i(j).name.includes(i(o)),He=>{var ye=Wt(),pe=m(ye),Xe=m(pe);d(pe);var xe=p(pe),Ze=m(xe);Ct(Ze,{get KV(){return i(l)},get bindingName(){return i(f)},get key(){return i(j)}}),d(xe);var Ve=p(xe),Oe=m(Ve);Oe.__click=[Gt,c,f,j];var we=p(Oe,2);Bt(we,{get KV(){return i(l)},get bindingName(){return i(f)},get key(){return i(j)}});var et=p(we,2);Ut(et,{get KV(){return i(l)},get bindingName(){return i(f)},get key(){return i(j)}}),d(Ve),d(ye),Q(()=>H(Xe,i(j).name)),u(He,ye)}),u(le,me)},le=>{var j=Ht(),me=m(j);ct(me,"colspan",3),d(j),u(le,j)}),u(oe,Se)}),d(ne),d(se),d(G);var ie=p(G,2);K(ie,()=>s().hasNextPage,oe=>{var ue=Zt();ue.__click=[Xt,s,x],Q(()=>ue.disabled=s().isFetchingNextPage),u(oe,ue)}),Q(()=>w.disabled=s().isFetching),Pt(O,()=>i(o),oe=>z(o,oe)),u(C,M)},null,!0),u(F,S)},!0),u(k,L)}),d(g),Q(()=>H(y,`[KV] ${r().params.bindingName??""}`)),u(a,g),de()}n(ba,"_page");_e(["click"]);export{ba as component};
