var U=Object.defineProperty;var o=(s,e)=>U(s,"name",{value:e,configurable:!0});var H=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var i=(s,e,t)=>(H(s,e,"read from private field"),t?t.call(s):e.get(s)),v=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},g=(s,e,t,n)=>(H(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t);var y=(s,e,t)=>(H(s,e,"access private method"),t);import{v as V,w as $,a as z,c as J,b as W,x as X,y as Y}from"./context.e8a7e09b.js";var T,k,Z=(k=class{constructor(){v(this,T,void 0)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),V(this.gcTime)&&g(this,T,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??($?1/0:5*60*1e3))}clearGcTimeout(){i(this,T)&&(clearTimeout(i(this,T)),g(this,T,void 0))}},T=new WeakMap,o(k,"Removable"),k),d,D,h,R,p,P,j,st=(j=class extends Z{constructor(t){super();v(this,p);v(this,d,void 0);v(this,D,void 0);v(this,h,void 0);v(this,R,void 0);this.mutationId=t.mutationId,g(this,D,t.defaultOptions),g(this,h,t.mutationCache),g(this,d,[]),this.state=t.state||_(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options={...i(this,D),...t},this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){i(this,d).includes(t)||(i(this,d).push(t),this.clearGcTimeout(),i(this,h).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){g(this,d,i(this,d).filter(n=>n!==t)),this.scheduleGc(),i(this,h).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){i(this,d).length||(this.state.status==="pending"?this.scheduleGc():i(this,h).remove(this))}continue(){var t;return((t=i(this,R))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var m,F,G,I,M,K,N,C,f,S,b,q,x,O,u,c,l,w,A,E;const n=o(()=>(g(this,R,J({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(r,B)=>{y(this,p,P).call(this,{type:"failed",failureCount:r,error:B})},onPause:()=>{y(this,p,P).call(this,{type:"pause"})},onContinue:()=>{y(this,p,P).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode})),i(this,R).promise),"executeMutation"),a=this.state.status==="pending";try{if(!a){y(this,p,P).call(this,{type:"pending",variables:t}),await((F=(m=i(this,h).config).onMutate)==null?void 0:F.call(m,t,this));const B=await((I=(G=this.options).onMutate)==null?void 0:I.call(G,t));B!==this.state.context&&y(this,p,P).call(this,{type:"pending",context:B,variables:t})}const r=await n();return await((K=(M=i(this,h).config).onSuccess)==null?void 0:K.call(M,r,t,this.state.context,this)),await((C=(N=this.options).onSuccess)==null?void 0:C.call(N,r,t,this.state.context)),await((S=(f=i(this,h).config).onSettled)==null?void 0:S.call(f,r,null,this.state.variables,this.state.context,this)),await((q=(b=this.options).onSettled)==null?void 0:q.call(b,r,null,t,this.state.context)),y(this,p,P).call(this,{type:"success",data:r}),r}catch(r){try{throw await((O=(x=i(this,h).config).onError)==null?void 0:O.call(x,r,t,this.state.context,this)),await((c=(u=this.options).onError)==null?void 0:c.call(u,r,t,this.state.context)),await((w=(l=i(this,h).config).onSettled)==null?void 0:w.call(l,void 0,r,this.state.variables,this.state.context,this)),await((E=(A=this.options).onSettled)==null?void 0:E.call(A,void 0,r,t,this.state.context)),r}finally{y(this,p,P).call(this,{type:"error",error:r})}}}},d=new WeakMap,D=new WeakMap,h=new WeakMap,R=new WeakMap,p=new WeakSet,P=o(function(t){const n=o(a=>{switch(t.type){case"failed":return{...a,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:!W(this.options.networkMode),status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...a,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:t.error,failureCount:a.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}},"reducer");this.state=n(this.state),z.batch(()=>{i(this,d).forEach(a=>{a.onMutationUpdate(t)}),i(this,h).notify({mutation:this,type:"updated",action:t})})},"#dispatch"),o(j,"Mutation"),j);function _(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}o(_,"getDefaultState");function it(s){return{onFetch:(e,t)=>{const n=o(async()=>{var S,b,q,x,O;const a=e.options,m=(q=(b=(S=e.fetchOptions)==null?void 0:S.meta)==null?void 0:b.fetchMore)==null?void 0:q.direction,F=((x=e.state.data)==null?void 0:x.pages)||[],G=((O=e.state.data)==null?void 0:O.pageParams)||[],I={pages:[],pageParams:[]};let M=!1;const K=o(u=>{Object.defineProperty(u,"signal",{enumerable:!0,get:()=>(e.signal.aborted?M=!0:e.signal.addEventListener("abort",()=>{M=!0}),e.signal)})},"addSignalProperty"),N=e.options.queryFn||(()=>Promise.reject(new Error(`Missing queryFn: '${e.options.queryHash}'`))),C=o(async(u,c,l)=>{if(M)return Promise.reject();if(c==null&&u.pages.length)return Promise.resolve(u);const w={queryKey:e.queryKey,pageParam:c,direction:l?"backward":"forward",meta:e.options.meta};K(w);const A=await N(w),{maxPages:E}=e.options,r=l?X:Y;return{pages:r(u.pages,A,E),pageParams:r(u.pageParams,c,E)}},"fetchPage");let f;if(m&&F.length){const u=m==="backward",c=u?Q:L,l={pages:F,pageParams:G},w=c(a,l);f=await C(l,w,u)}else{f=await C(I,G[0]??a.initialPageParam);const u=s??F.length;for(let c=1;c<u;c++){const l=L(a,f);f=await C(f,l)}}return f},"fetchFn");e.options.persister?e.fetchFn=()=>{var a,m;return(m=(a=e.options).persister)==null?void 0:m.call(a,n,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=n}}}o(it,"infiniteQueryBehavior");function L(s,{pages:e,pageParams:t}){const n=e.length-1;return s.getNextPageParam(e[n],e,t[n],t)}o(L,"getNextPageParam");function Q(s,{pages:e,pageParams:t}){var n;return(n=s.getPreviousPageParam)==null?void 0:n.call(s,e[0],e,t[0],t)}o(Q,"getPreviousPageParam");function at(s,e){return e?L(s,e)!=null:!1}o(at,"hasNextPage");function rt(s,e){return!e||!s.getPreviousPageParam?!1:Q(s,e)!=null}o(rt,"hasPreviousPage");export{st as M,Z as R,rt as a,_ as g,at as h,it as i};
