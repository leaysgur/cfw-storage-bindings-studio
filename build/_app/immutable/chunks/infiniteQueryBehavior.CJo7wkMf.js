var L=Object.defineProperty;var Q=s=>{throw TypeError(s)};var i=(s,e)=>L(s,"name",{value:e,configurable:!0});var A=(s,e,t)=>e.has(s)||Q("Cannot "+t);var a=(s,e,t)=>(A(s,e,"read from private field"),t?t.call(s):e.get(s)),D=(s,e,t)=>e.has(s)?Q("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),G=(s,e,t,n)=>(A(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),m=(s,e,t)=>(A(s,e,"access private method"),t);import{R as U,c as z,n as H,a as J,b as V,d as W}from"./context.CNAOubcP.js";var c,u,F,d,y,C,_=(C=class extends U{constructor(t){super();D(this,d);D(this,c);D(this,u);D(this,F);this.mutationId=t.mutationId,G(this,u,t.mutationCache),G(this,c,[]),this.state=t.state||X(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){a(this,c).includes(t)||(a(this,c).push(t),this.clearGcTimeout(),a(this,u).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){G(this,c,a(this,c).filter(n=>n!==t)),this.scheduleGc(),a(this,u).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){a(this,c).length||(this.state.status==="pending"?this.scheduleGc():a(this,u).remove(this))}continue(){var t;return((t=a(this,F))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var R,b,p,P,S,M,O,q,x,E,f,w,N,T,h,l,g,v,K,k;G(this,F,z({fn:i(()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),"fn"),onFail:i((r,j)=>{m(this,d,y).call(this,{type:"failed",failureCount:r,error:j})},"onFail"),onPause:i(()=>{m(this,d,y).call(this,{type:"pause"})},"onPause"),onContinue:i(()=>{m(this,d,y).call(this,{type:"continue"})},"onContinue"),retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:i(()=>a(this,u).canRun(this),"canRun")}));const n=this.state.status==="pending",o=!a(this,F).canStart();try{if(!n){m(this,d,y).call(this,{type:"pending",variables:t,isPaused:o}),await((b=(R=a(this,u).config).onMutate)==null?void 0:b.call(R,t,this));const j=await((P=(p=this.options).onMutate)==null?void 0:P.call(p,t));j!==this.state.context&&m(this,d,y).call(this,{type:"pending",context:j,variables:t,isPaused:o})}const r=await a(this,F).start();return await((M=(S=a(this,u).config).onSuccess)==null?void 0:M.call(S,r,t,this.state.context,this)),await((q=(O=this.options).onSuccess)==null?void 0:q.call(O,r,t,this.state.context)),await((E=(x=a(this,u).config).onSettled)==null?void 0:E.call(x,r,null,this.state.variables,this.state.context,this)),await((w=(f=this.options).onSettled)==null?void 0:w.call(f,r,null,t,this.state.context)),m(this,d,y).call(this,{type:"success",data:r}),r}catch(r){try{throw await((T=(N=a(this,u).config).onError)==null?void 0:T.call(N,r,t,this.state.context,this)),await((l=(h=this.options).onError)==null?void 0:l.call(h,r,t,this.state.context)),await((v=(g=a(this,u).config).onSettled)==null?void 0:v.call(g,void 0,r,this.state.variables,this.state.context,this)),await((k=(K=this.options).onSettled)==null?void 0:k.call(K,void 0,r,t,this.state.context)),r}finally{m(this,d,y).call(this,{type:"error",error:r})}}finally{a(this,u).runNext(this)}}},c=new WeakMap,u=new WeakMap,F=new WeakMap,d=new WeakSet,y=i(function(t){const n=i(o=>{switch(t.type){case"failed":return{...o,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...o,isPaused:!0};case"continue":return{...o,isPaused:!1};case"pending":return{...o,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...o,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...o,data:void 0,error:t.error,failureCount:o.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}},"reducer");this.state=n(this.state),H.batch(()=>{a(this,c).forEach(o=>{o.onMutationUpdate(t)}),a(this,u).notify({mutation:this,type:"updated",action:t})})},"#dispatch"),i(C,"Mutation"),C);function X(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}i(X,"getDefaultState");function $(s){return{onFetch:i((e,t)=>{var M,O,q,x,E;const n=e.options,o=(q=(O=(M=e.fetchOptions)==null?void 0:M.meta)==null?void 0:O.fetchMore)==null?void 0:q.direction,R=((x=e.state.data)==null?void 0:x.pages)||[],b=((E=e.state.data)==null?void 0:E.pageParams)||[];let p={pages:[],pageParams:[]},P=0;const S=i(async()=>{let f=!1;const w=i(h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:i(()=>(e.signal.aborted?f=!0:e.signal.addEventListener("abort",()=>{f=!0}),e.signal),"get")})},"addSignalProperty"),N=J(e.options,e.fetchOptions),T=i(async(h,l,g)=>{if(f)return Promise.reject();if(l==null&&h.pages.length)return Promise.resolve(h);const v={queryKey:e.queryKey,pageParam:l,direction:g?"backward":"forward",meta:e.options.meta};w(v);const K=await N(v),{maxPages:k}=e.options,r=g?V:W;return{pages:r(h.pages,K,k),pageParams:r(h.pageParams,l,k)}},"fetchPage");if(o&&R.length){const h=o==="backward",l=h?B:I,g={pages:R,pageParams:b},v=l(n,g);p=await T(g,v,h)}else{const h=s??R.length;do{const l=P===0?b[0]??n.initialPageParam:I(n,p);if(P>0&&l==null)break;p=await T(p,l),P++}while(P<h)}return p},"fetchFn");e.options.persister?e.fetchFn=()=>{var f,w;return(w=(f=e.options).persister)==null?void 0:w.call(f,S,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=S},"onFetch")}}i($,"infiniteQueryBehavior");function I(s,{pages:e,pageParams:t}){const n=e.length-1;return e.length>0?s.getNextPageParam(e[n],e,t[n],t):void 0}i(I,"getNextPageParam");function B(s,{pages:e,pageParams:t}){var n;return e.length>0?(n=s.getPreviousPageParam)==null?void 0:n.call(s,e[0],e,t[0],t):void 0}i(B,"getPreviousPageParam");function tt(s,e){return e?I(s,e)!=null:!1}i(tt,"hasNextPage");function et(s,e){return!e||!s.getPreviousPageParam?!1:B(s,e)!=null}i(et,"hasPreviousPage");export{_ as M,et as a,X as g,tt as h,$ as i};
