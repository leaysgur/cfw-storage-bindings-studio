var Ct=Object.defineProperty;var dt=i=>{throw TypeError(i)};var o=(i,r)=>Ct(i,"name",{value:r,configurable:!0});var J=(i,r,e)=>r.has(i)||dt("Cannot "+e);var t=(i,r,e)=>(J(i,r,"read from private field"),e?e.call(i):r.get(i)),f=(i,r,e)=>r.has(i)?dt("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(i):r.set(i,e),u=(i,r,e,s)=>(J(i,r,"write to private field"),s?s.call(i,e):r.set(i,e),e),d=(i,r,e)=>(J(i,r,"access private method"),e);import{S as Ot,p as ft,r as I,s as Y,f as N,g as St,h as pt,j as bt,t as It,k as Qt,l as Ut,m as vt,n as Rt,o as wt,q as Et}from"./context.CNAOubcP.js";import{r as Ft,d as X,g as Tt}from"./parse.RgkxDUh4.js";var R,n,B,g,F,M,U,S,W,P,j,T,D,w,k,a,z,Z,$,q,tt,et,st,it,yt,_,Dt=(_=class extends Ot{constructor(e,s){super();f(this,a);f(this,R);f(this,n);f(this,B);f(this,g);f(this,F);f(this,M);f(this,U);f(this,S);f(this,W);f(this,P);f(this,j);f(this,T);f(this,D);f(this,w);f(this,k,new Set);this.options=s,u(this,R,e),u(this,S,null),u(this,U,ft()),this.options.experimental_prefetchInRender||t(this,U).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(t(this,n).addObserver(this),gt(t(this,n),this.options)?d(this,a,z).call(this):this.updateResult(),d(this,a,tt).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return rt(t(this,n),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return rt(t(this,n),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,d(this,a,et).call(this),d(this,a,st).call(this),t(this,n).removeObserver(this)}setOptions(e,s){const h=this.options,b=t(this,n);if(this.options=t(this,R).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof I(this.options.enabled,t(this,n))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");d(this,a,it).call(this),t(this,n).setOptions(this.options),h._defaulted&&!Y(this.options,h)&&t(this,R).getQueryCache().notify({type:"observerOptionsUpdated",query:t(this,n),observer:this});const l=this.hasListeners();l&&mt(t(this,n),b,this.options,h)&&d(this,a,z).call(this),this.updateResult(s),l&&(t(this,n)!==b||I(this.options.enabled,t(this,n))!==I(h.enabled,t(this,n))||N(this.options.staleTime,t(this,n))!==N(h.staleTime,t(this,n)))&&d(this,a,Z).call(this);const p=d(this,a,$).call(this);l&&(t(this,n)!==b||I(this.options.enabled,t(this,n))!==I(h.enabled,t(this,n))||p!==t(this,w))&&d(this,a,q).call(this,p)}getOptimisticResult(e){const s=t(this,R).getQueryCache().build(t(this,R),e),h=this.createResult(s,e);return Lt(this,h)&&(u(this,g,h),u(this,M,this.options),u(this,F,t(this,n).state)),h}getCurrentResult(){return t(this,g)}trackResult(e,s){const h={};return Object.keys(e).forEach(b=>{Object.defineProperty(h,b,{configurable:!1,enumerable:!0,get:o(()=>(this.trackProp(b),s==null||s(b),e[b]),"get")})}),h}trackProp(e){t(this,k).add(e)}getCurrentQuery(){return t(this,n)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=t(this,R).defaultQueryOptions(e),h=t(this,R).getQueryCache().build(t(this,R),s);return h.fetch().then(()=>this.createResult(h,s))}fetch(e){return d(this,a,z).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),t(this,g)))}createResult(e,s){var lt;const h=t(this,n),b=this.options,l=t(this,g),p=t(this,F),Q=t(this,M),m=e!==h?e.state:t(this,B),{state:y}=e;let c={...y},at=!1,C;if(s._optimisticResults){const v=this.hasListeners(),x=!v&&gt(e,s),L=v&&mt(e,h,s,b);(x||L)&&(c={...c,...Ut(y.data,e.options)}),s._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:ht,errorUpdatedAt:ot,status:E}=c;if(s.select&&c.data!==void 0)if(l&&c.data===(p==null?void 0:p.data)&&s.select===t(this,W))C=t(this,P);else try{u(this,W,s.select),C=s.select(c.data),C=vt(l==null?void 0:l.data,C,s),u(this,P,C),u(this,S,null)}catch(v){u(this,S,v)}else C=c.data;if(s.placeholderData!==void 0&&C===void 0&&E==="pending"){let v;if(l!=null&&l.isPlaceholderData&&s.placeholderData===(Q==null?void 0:Q.placeholderData))v=l.data;else if(v=typeof s.placeholderData=="function"?s.placeholderData((lt=t(this,j))==null?void 0:lt.state.data,t(this,j)):s.placeholderData,s.select&&v!==void 0)try{v=s.select(v),u(this,S,null)}catch(x){u(this,S,x)}v!==void 0&&(E="success",C=vt(l==null?void 0:l.data,v,s),at=!0)}t(this,S)&&(ht=t(this,S),C=t(this,P),ot=Date.now(),E="error");const V=c.fetchStatus==="fetching",K=E==="pending",G=E==="error",ct=K&&V,ut=C!==void 0,O={status:E,fetchStatus:c.fetchStatus,isPending:K,isSuccess:E==="success",isError:G,isInitialLoading:ct,isLoading:ct,data:C,dataUpdatedAt:c.dataUpdatedAt,error:ht,errorUpdatedAt:ot,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>m.dataUpdateCount||c.errorUpdateCount>m.errorUpdateCount,isFetching:V,isRefetching:V&&!K,isLoadingError:G&&!ut,isPaused:c.fetchStatus==="paused",isPlaceholderData:at,isRefetchError:G&&ut,isStale:nt(e,s),refetch:this.refetch,promise:t(this,U)};if(this.options.experimental_prefetchInRender){const v=o(H=>{O.status==="error"?H.reject(O.error):O.data!==void 0&&H.resolve(O.data)},"finalizeThenableIfPossible"),x=o(()=>{const H=u(this,U,O.promise=ft());v(H)},"recreateThenable"),L=t(this,U);switch(L.status){case"pending":e.queryHash===h.queryHash&&v(L);break;case"fulfilled":(O.status==="error"||O.data!==L.value)&&x();break;case"rejected":(O.status!=="error"||O.error!==L.reason)&&x();break}}return O}updateResult(e){const s=t(this,g),h=this.createResult(t(this,n),this.options);if(u(this,F,t(this,n).state),u(this,M,this.options),t(this,F).data!==void 0&&u(this,j,t(this,n)),Y(h,s))return;u(this,g,h);const b={},l=o(()=>{if(!s)return!0;const{notifyOnChangeProps:p}=this.options,Q=typeof p=="function"?p():p;if(Q==="all"||!Q&&!t(this,k).size)return!0;const A=new Set(Q??t(this,k));return this.options.throwOnError&&A.add("error"),Object.keys(t(this,g)).some(m=>{const y=m;return t(this,g)[y]!==s[y]&&A.has(y)})},"shouldNotifyListeners");(e==null?void 0:e.listeners)!==!1&&l()&&(b.listeners=!0),d(this,a,yt).call(this,{...b,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&d(this,a,tt).call(this)}},R=new WeakMap,n=new WeakMap,B=new WeakMap,g=new WeakMap,F=new WeakMap,M=new WeakMap,U=new WeakMap,S=new WeakMap,W=new WeakMap,P=new WeakMap,j=new WeakMap,T=new WeakMap,D=new WeakMap,w=new WeakMap,k=new WeakMap,a=new WeakSet,z=o(function(e){d(this,a,it).call(this);let s=t(this,n).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(St)),s},"#executeFetch"),Z=o(function(){d(this,a,et).call(this);const e=N(this.options.staleTime,t(this,n));if(pt||t(this,g).isStale||!bt(e))return;const h=It(t(this,g).dataUpdatedAt,e)+1;u(this,T,setTimeout(()=>{t(this,g).isStale||this.updateResult()},h))},"#updateStaleTimeout"),$=o(function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(t(this,n)):this.options.refetchInterval)??!1},"#computeRefetchInterval"),q=o(function(e){d(this,a,st).call(this),u(this,w,e),!(pt||I(this.options.enabled,t(this,n))===!1||!bt(t(this,w))||t(this,w)===0)&&u(this,D,setInterval(()=>{(this.options.refetchIntervalInBackground||Qt.isFocused())&&d(this,a,z).call(this)},t(this,w)))},"#updateRefetchInterval"),tt=o(function(){d(this,a,Z).call(this),d(this,a,q).call(this,d(this,a,$).call(this))},"#updateTimers"),et=o(function(){t(this,T)&&(clearTimeout(t(this,T)),u(this,T,void 0))},"#clearStaleTimeout"),st=o(function(){t(this,D)&&(clearInterval(t(this,D)),u(this,D,void 0))},"#clearRefetchInterval"),it=o(function(){const e=t(this,R).getQueryCache().build(t(this,R),this.options);if(e===t(this,n))return;const s=t(this,n);u(this,n,e),u(this,B,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},"#updateQuery"),yt=o(function(e){Rt.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(t(this,g))}),t(this,R).getQueryCache().notify({query:t(this,n),type:"observerResultsUpdated"})})},"#notify"),o(_,"QueryObserver"),_);function xt(i,r){return I(r.enabled,i)!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&r.retryOnMount===!1)}o(xt,"shouldLoadOnMount");function gt(i,r){return xt(i,r)||i.state.data!==void 0&&rt(i,r,r.refetchOnMount)}o(gt,"shouldFetchOnMount");function rt(i,r,e){if(I(r.enabled,i)!==!1){const s=typeof e=="function"?e(i):e;return s==="always"||s!==!1&&nt(i,r)}return!1}o(rt,"shouldFetchOn");function mt(i,r,e,s){return(i!==r||I(s.enabled,i)===!1)&&(!e.suspense||i.state.status!=="error")&&nt(i,e)}o(mt,"shouldFetchOptionally");function nt(i,r){return I(r.enabled,i)!==!1&&i.isStaleByTime(N(r.staleTime,i))}o(nt,"isStale");function Lt(i,r){return!Y(i.getCurrentResult(),r)}o(Lt,"shouldAssignObserverCurrentProperties");function Mt(){return wt()}o(Mt,"useIsRestoring");function Pt(i){return Et()}o(Pt,"useQueryClient");function jt(i){return"subscribe"in i&&typeof i.subscribe=="function"}o(jt,"isSvelteStore");function Wt(){}o(Wt,"noop");function kt(i,r,e){const s=Pt(),h=Mt(),b=jt(i)?i:Ft(i),l=X([b,h],([m,y])=>{const c=s.defaultQueryOptions(m);return c._optimisticResults=y?"isRestoring":"optimistic",c}),p=new r(s,Tt(l));l.subscribe(m=>{p.setOptions(m,{listeners:!1})});const Q=X(h,(m,y)=>{const c=m?()=>{}:p.subscribe(Rt.batchCalls(y));return p.updateResult(),c}),{subscribe:A}=X([Q,l],([m,y])=>(m=p.getOptimisticResult(y),y.notifyOnChangeProps?m:p.trackResult(m)));return{subscribe:A}}o(kt,"createBaseQuery");function Ht(i,r){return kt(i,Dt)}o(Ht,"createQuery");export{Dt as Q,kt as a,Ht as c,jt as i,Wt as n,Pt as u};
